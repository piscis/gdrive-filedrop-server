"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _multer=require("multer"),_multer2=_interopRequireDefault(_multer),_gdrive=require("./../services/gdrive"),_gdrive2=_interopRequireDefault(_gdrive),_config=require("./../services/config"),_config2=_interopRequireDefault(_config),_path=require("path"),_path2=_interopRequireDefault(_path),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_logger=require("./../services/logger"),_logger2=_interopRequireDefault(_logger),_nodeUuid=require("node-uuid"),_nodeUuid2=_interopRequireDefault(_nodeUuid);exports["default"]=function(e){var r=_path2["default"].resolve(_config2["default"].server.uploadDir),u=(0,_multer2["default"])({dest:r});e.post("/files/upload",u.array("files",600),function(e,r,u){var t=e.body.description,i=e.files,o=e.body.group||_nodeUuid2["default"].v4(),f=function(e){e.forEach(function(e){_fs2["default"].unlink(_path2["default"].resolve(e.path))})};(0,_gdrive2["default"])(t,i,o).then(function(e){r.status(200).send({success:!0}),f(i)})["catch"](function(e){_logger2["default"].error("Upload failed",e),u(),f(i)})})};