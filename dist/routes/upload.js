"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _multer=require("multer"),_multer2=_interopRequireDefault(_multer),_gdrive=require("./../services/gdrive"),_gdrive2=_interopRequireDefault(_gdrive),_config=require("./../services/config"),_config2=_interopRequireDefault(_config),_path=require("path"),_path2=_interopRequireDefault(_path),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_logger=require("./../services/logger"),_logger2=_interopRequireDefault(_logger);exports["default"]=function(e){var r=_path2["default"].resolve(_config2["default"].server.uploadDir),t=(0,_multer2["default"])({dest:r});e.post("/files/upload",t.array("files",600),function(e,r,t){var u=e.body.description,i=e.files,f=function(e){e.forEach(function(e){_fs2["default"].unlink(_path2["default"].resolve(e.path))})};(0,_gdrive2["default"])(u,i).then(function(e){r.status(200).send({success:!0}),f(i)})["catch"](function(e){_logger2["default"].error("Upload failed",e),t(),f(i)})})};