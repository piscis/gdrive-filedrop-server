"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=function(){var e=arguments.length<=0||void 0===arguments[0]?"NO_DESCRIPTION":arguments[0],i=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],t=arguments.length<=2||void 0===arguments[2]?"":arguments[2];return new _bluebird2["default"](function(r,n){var a=new _googleapis2["default"].auth.JWT(keystore.client_email,null,keystore.private_key,scopes,null);a.authorize(function(u){u?n(u):!function(){var u="Upload_"+(0,_moment2["default"])().format("YYYY-MM-DD_HH:mm:ss");drive.files.list({auth:a,q:"mimeType = 'application/vnd.google-apps.folder' and '"+uploadFolderId+"' in parents and properties has { key='group' and value='"+t+"' and visibility='PRIVATE' }",maxResults:1},function(o,l){if(o)n(o);else if(l.items.length>0){var s=l.items[0].id;uploadFiles(i,e,s,n,r,a)}else drive.files.insert({auth:a,resource:{title:u,mimeType:"application/vnd.google-apps.folder",description:e,parents:[{kind:"drive#fileLink",id:uploadFolderId}],properties:[{key:"group",value:t,visibility:"PRIVATE"}]}},function(t,u){t&&n(t),uploadFiles(i,e,u.id,n,r,a)})})}()})})};var _googleapis=require("googleapis"),_googleapis2=_interopRequireDefault(_googleapis),_config=require("./config"),_config2=_interopRequireDefault(_config),_bluebird=require("bluebird"),_bluebird2=_interopRequireDefault(_bluebird),_async=require("async"),_async2=_interopRequireDefault(_async),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_path=require("path"),_path2=_interopRequireDefault(_path),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),_nodeUuid=require("node-uuid"),_nodeUuid2=_interopRequireDefault(_nodeUuid),_mime=require("mime"),_mime2=_interopRequireDefault(_mime),keystore=_config2["default"].keystore,uploadFolderId=_config2["default"].uploadFolderId,drive=_googleapis2["default"].drive("v2"),scopes=["https://www.googleapis.com/auth/drive"],uploadFiles=function(e,i,t,r,n,a){var u=function(e,r){var n=_nodeUuid2["default"].v4()+"."+_mime2["default"].extension(e.mimetype),u="\n      Description: "+i+"\n      Original Filename: "+e.originalname+"\n    ";drive.files.insert({auth:a,resource:{title:n,mimeType:e.mimetype,description:u,parents:[{kind:"drive#fileLink",id:t}]},media:{mimeType:e.mimetype,body:_fs2["default"].createReadStream(_path2["default"].resolve(e.path))}},r)};_async2["default"].each(e,u,function(e){e?r(e):n({success:!0})})};